# Guia de Configura√ß√£o do Zabbix na Oracle Cloud Infrastructure (OCI)

Este `README.md` detalha os passos para criar uma M√°quina Virtual (VM) com Ubuntu Linux na Oracle Cloud Infrastructure (OCI) e, em seguida, instalar e configurar o Zabbix Agent nessa VM para monitorar seus recursos com um Zabbix Server externo (ou em cont√™ineres na mesma VM).

![Dashboard](./img/dashboard.png)

---

## Projeto: Monitoramento de infraestrutura com Zabbix

Este projeto oferece uma solu√ß√£o robusta e escal√°vel para **monitoramento de infraestrutura**, utilizando o poder do Zabbix, um software de c√≥digo aberto l√≠der em monitoramento de rede e sistemas. Desenvolvido para flexibilidade, ele se adapta facilmente a diversos ambientes, garantindo que voc√™ tenha visibilidade total sobre a sa√∫de e performance dos seus sistemas.

---

### üíª Tecnologias envolvidas

* **Oracle Cloud:** Uma inst√¢ncia de teste da Oracle Cloud foi usada para a cria√ß√£o do ambiente.
* **Ubuntu 24.04:** Sistema operacional base para a m√°quina virtual.
* **Zabbix (`alpine-7.2-latest`):** A plataforma central de monitoramento.
* **Zabbix Web:** Interface web do Zabbix.
* **Zabbix Agent:** Servi√ßo de monitoramento para os hosts.
* **Nginx:** Servidor web para a interface do Zabbix.
* **MySQL (`8.0`):** Banco de dados para o Zabbix, escolhido por sua estabilidade e performance.
* **Docker:** Para orquestra√ß√£o eficiente e isolamento dos servi√ßos.
* **YAML:** Utilizado para a configura√ß√£o dos servi√ßos via Docker Compose.

---

### ‚öôÔ∏è Configura√ß√µes essenciais

Para colocar o projeto em funcionamento, siga estas etapas de configura√ß√£o:

1.  **Crie uma conta na Oracle Cloud:** Fa√ßa login ou crie uma nova conta em [Oracle Cloud](https://www.oracle.com/br/cloud/).
    ![P√°gina inicial da Oracle Cloud Brasil](./img/pagina_inicial_oracle.png)

2.  **Cria√ß√£o da VM Ubuntu na Oracle Cloud Infrastructure (OCI)**

    #### 2.1. Criar uma virtual vloud network (VCN)
    Uma VCN √© sua rede privada na OCI.

    * Acesse o console da OCI e navegue para **Rede > Redes virtuais na nuvem**.
    * Selecione o **Compartimento** (compartimento) desejado.
    ![Filtro de compartimento](./img/vcn-image1.png)
    * Clique em **Criar VCN**.
    ![bot√£o de cria√ß√£o](./img/vcn-image2.png)
    * **Nome:** D√™ um nome significativo (ex: `zabbix-vcn`).
    ![bot√£o de cria√ß√£o](./img/vcn-image3.png)
    * **Blocos CIDR IPv4:** Mantenha o padr√£o `10.0.0.0/24` ou defina um de sua prefer√™ncia.
    ![bot√£o de cria√ß√£o](./img/vcn-image4.png)
    * Marque a op√ß√£o **Usar nomes de host de DNS nesta VCN**.
    ![bot√£o de cria√ß√£o](./img/vcn-image5.png)
    * Clique em **Create VCN**.
    ![bot√£o de cria√ß√£o](./img/vcn-image6.png)

    #### 2.2. Criar uma subnet
    Uma subnet √© uma sub-rede privada dentro da VCN.

    * Acesse o console da OCI e navegue para **Rede > Redes virtuais na nuvem**.
    * Selecione a VCN criada anteriormente (`zabbix-vcn`).
    ![bot√£o de cria√ß√£o](./img/vcn-image7.png)
    * Clique em **Sub-redes**.
    ![bot√£o de cria√ß√£o](./img/vcn-image8.png)
    * Clique em **Criar Sub-rede**.
    ![bot√£o de cria√ß√£o](./img/vcn-image9.png)
    * **Nome:** D√™ um nome significativo (ex: `zabbix-vcn-subnet`).
    * **Blocos CIDR IPv4:** Mantenha o padr√£o `10.0.0.0/24` ou defina um de sua prefer√™ncia.
    * Clique em **Create Subnet**.
    ![bot√£o de cria√ß√£o](./img/vcn-image10.png)

    #### 2.3. Gerar Chaves SSH
    As chaves SSH s√£o essenciais para a conex√£o segura com a VM.

    * Abra um terminal (Linux/macOS) ou Git Bash/WSL (Windows).
    * Execute o comando para gerar o par de chaves:
        ```bash
        ssh-keygen -t rsa -b 2048 -f ~/.ssh/zabbix_key
        ```
    ***Obs:** O arquivo `~/.ssh/zabbix_key` cont√©m a chave privada. Caso queira salvar o par de chaves em um outro diret√≥rio, basta alterar o path (`~/.ssh/`) da chave privada no comando acima.
    * Copie o conte√∫do da sua chave p√∫blica. Voc√™ a usar√° na cria√ß√£o da VM.
        ```bash
        cat ~/.ssh/zabbix_key.pub
        ```

    #### 2.3. Lan√ßar a Inst√¢ncia de Computa√ß√£o (VM)

    * No menu da OCI, v√° para **Computa√ß√£o > Inst√¢ncias** e clique em **Create Instance**.
    ![bot√£o de cria√ß√£o](./img/vm-image1.png)
    ![bot√£o de cria√ß√£o](./img/vm-image2.png)
    * **Nome:** D√™ um nome √† sua VM (ex: `zabbix-vm`).
    ![bot√£o de cria√ß√£o](./img/vm-image3.png)
    * **Imagem e forma:**
        * **Imagem:** Clique em **Alterar Imagem**;
        ![bot√£o de cria√ß√£o](./img/vm-image4.png)
        * Selecione **Canonical Ubuntu** e a vers√£o desejada (ex: `24.04 LTS`).
        ![bot√£o de cria√ß√£o](./img/vm-image5.png)
        * **Forma:** Clique em **Alterar Forma** e escolha uma forma adequada (ex: `VM.Standard.E2.2`).
        ![bot√£o de cria√ß√£o](./img/vm-image6.png)
        ![bot√£o de cria√ß√£o](./img/vm-image7.png)
    * **Rede:**
        * **Rede virtual na nuvem:** Selecione a VCN criada anteriormente (`zabbix-vcn`).
        ![bot√£o de cria√ß√£o](./img/vm-image8.png)
        * **Sub-rede:** Escolha a sub-rede p√∫blica.
        ![bot√£o de cria√ß√£o](./img/vm-image9.png)
        * **Endere√ßo de IP p√∫blico:** Marque **Marque: designar endere√ßo IPv4 p√∫blico automaticamente**.
        ![bot√£o de cria√ß√£o](./img/vm-image10.png)
    * **Adicionar chaves SSH:** Selecione **Colar chave p√∫blica** e cole o conte√∫do da sua chave p√∫blica (`~/.ssh/zabbix_key.pub`).
    ![bot√£o de cria√ß√£o](./img/vm-image11.png)
    * **Armazenamento:** Para o projeto n√£o h√° necessidade de alterar o armazenamento da VM o padr√£o `50` GB ser√° suficiente.
    ![bot√£o de cria√ß√£o](./img/vm-image12.png)
    * Clique em **Pr√≥ximo** e depois em **Criar**.
    * Aguarde a inst√¢ncia ficar com o status "Executando" e anote o **Endere√ßo de IP p√∫blico**.

    #### 2.4. Configurar Regras de Seguran√ßa (Firewall da OCI)
    Abra as portas necess√°rias para a comunica√ß√£o.

    * Navegue at√© os detalhes da sua inst√¢ncia e clique em **Rede**, depois em **Sub-rede** clique no nome da sua sub-rede (`zabbix-vcn-subnet`).
    ![bot√£o de cria√ß√£o](./img/fw-image1.png)
    ![bot√£o de cria√ß√£o](./img/fw-image2.png)
    * Clique em **Seguran√ßa**;
    ![bot√£o de cria√ß√£o](./img/fw-image3.png)

    * Clique na **Default Security List** e depois em **Regras de seguran√ßa**.
    ![bot√£o de cria√ß√£o](./img/fw-image4.png)
    ![bot√£o de cria√ß√£o](./img/fw-image5.png)
    * Clique em **Adicionar regras de seguran√ßa** e adicione as seguintes regras de entrada:
    ![bot√£o de cria√ß√£o](./img/fw-image6.png)
        * **Regra para SSH (Porta 22):**
            * **CIDR de origem:** `0.0.0.0/0`
            * **Protocolo IP:** `TCP`
            * **Intervalo de portas de destino:** `22`
        * **Regra para Zabbix Agent (Porta 10050):**
            * **CIDR de origem:** `0.0.0.0/0` (ou o IP do seu Zabbix Server para mais seguran√ßa).
            * **Protocolo IP:** `TCP`
            * **Intervalo de portas de destino:** `10050`
        * **Regras para Zabbix Web (Portas 8080/8443):**
            * **CIDR de origem:** `0.0.0.0/0`
            * **Protocolo IP:** `TCP`
            * **Intervalo de portas de destino:** `8080` (HTTP) e/ou `8443` (HTTPS).
            ![bot√£o de cria√ß√£o](./img/fw-image7.png)

    #### 2.5. Conectar-se √† VM via SSH

    * No seu terminal, ajuste as permiss√µes da chave privada:
        ```bash
        chmod 400 ~/.ssh/zabbix_key
        ```
        * **Obs:** O arquivo `~/.ssh/zabbix_key` cont√©m a chave privada o comando acima altera as permiss√µes para 400, ou seja, apenas o propriet√°rio da chave tem permissoes de leitura.
    * Conecte-se usando o IP p√∫blico da sua VM:
        ```bash
        ssh -i ~/.ssh/zabbix_key ubuntu@<SEU_IP_PUBLICO_DA_VM>
        ```

3.  **Instala√ß√£o e Configura√ß√£o do Zabbix Agent no Host Linux**

    #### 3.1. Instalar o Zabbix Agent

    * Acesse sua VM via SSH.
    * Baixe e instale o pacote de reposit√≥rio do Zabbix. Ajuste a URL para a vers√£o compat√≠vel com seu Zabbix Server.
        ```bash
        wget https://repo.zabbix.com/zabbix/7.2/release/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest_7.2+ubuntu24.04_all.deb

        dpkg -i zabbix-release_latest_7.2+ubuntu24.04_all.deb
        ```
    * Atualize o cache e instale o agente:
        ```bash
        sudo apt update
        sudo apt install zabbix-agent
        ```
    * Verifique se o servi√ßo est√° ativo:
        ```bash
        sudo systemctl status zabbix-agent
        ```
        ![bot√£o de cria√ß√£o](./img/status-zabbix-agent.png)
    #### 3.2. Configurar o Zabbix Agent

    * Edite o arquivo de configura√ß√£o:
        ```bash
        sudo nano /etc/zabbix/zabbix_agentd.conf
        ```
    * Modifique as seguintes linhas:
        * `Server`: IP do seu Zabbix Server. Se o server estiver na mesma VM, pode usar o IP p√∫blico dela.
        * `ServerActive`: IP e porta do seu Zabbix Server para checagens ativas (ex: `<IP publico da VM>:10051`).
        * `Hostname`: Nome √∫nico para o host. **Deve ser id√™ntico** ao que ser√° cadastrado no Zabbix Frontend.
        * **Obs:** O copie o hostname para o campo do Zabbix Frontend.
    * Salve o arquivo (ctrl + o, Enter, ctrl + x), reinicie e verifique o status do servi√ßo:
        ```bash
        sudo systemctl restart zabbix-agent
        sudo systemctl status zabbix-agent
        ```

    #### 3.3. Configurar o firewall interno do host (iptables)
    * **Obs:** Primeiro adicione o host ao zabbix frontend e analise se os dados est√£o sendo enviados, caso nao, verifique se existe alguma regra de firewall bloqueando a porta 10050.
    Na instancia padr√£o do Ubuntu server da Oracle Cloud Infrastructure (OCI), precisei alterar o firewall para permitir a porta 10050.
    * Rode o comando para analizar a tabela de Input do Firewall: 
        ```bash
        sudo iptables -L -n
        ```

    * Adicione uma regra para permitir conex√µes na porta 10050:
        ```bash
        sudo iptables -I INPUT 5 -p tcp --dport 10050 -j ACCEPT
        ```
    * **Obs:** O `5` indica que a regra deve ser inserida na quinta posi√ß√£o da cadeia de regras.

    * Verifique se a regra foi adicionada corretamente:
        ```bash
        sudo iptables -L -n
        ```
        ![bot√£o de cria√ß√£o](./img/fw-image8.png)
    
    * Instale o `netfilter-persistent` para salvar a regra ap√≥s reinicializa√ß√µes:
        ```bash
        sudo apt install netfilter-persistent
        sudo netfilter-persistent save
        ```

    #### 3.4. Adicionar o host no Zabbix frontend

    * Acesse sua interface web do Zabbix.
    * V√° para **Configuration > Hosts** e clique em **Create host**.
    * Preencha os campos:
        * **Host name:** Digite o nome **exato** configurado no `zabbix_agentd.conf`.
        * **Groups:** Associe a um grupo (ex: `Linux servers`).
        * **Interfaces:** Adicione uma interface do tipo **Zabbix agent**, preenchendo o **IP address** p√∫blico da VM e a porta `10050`.
    * Na aba **Templates**, vincule um modelo apropriado, como `Linux by Zabbix agent`.
    * Clique em **Add** para salvar.

    #### 3.5. Verificar a Coleta de Dados

    * Aguarde alguns minutos.
    * V√° para **Monitoring > Latest data**.
    * Filtre pelo host rec√©m-criado para ver os dados sendo coletados. O √≠cone de disponibilidade do host em **Configuration > Hosts** deve ficar verde.

---

## Iniciando o projeto (com Docker)

Se o seu Zabbix Server est√° conteinerizado, siga estas etapas para inici√°-lo:

1.  **Clone o reposit√≥rio:**
    ```bash
    git clone [https://github.com/mizaelZuza/zabbix-monitoramento.git](https://github.com/mizaelZuza/zabbix-monitoramento.git)
    cd zabbix-monitoramento
    ```

2.  **Crie e configure o arquivo `.env`:** Este arquivo guarda suas vari√°veis de ambiente. Crie-o na raiz do projeto.
    ```
    MYSQL_DATABASE=(nome do database)
    MYSQL_USER=(nome do usu√°rio)
    MYSQL_PASSWORD=(senha do usuario do banco)
    MYSQL_ROOT_PASSWORD=(senha root do banco)
    ZABBIX_SERVER_PORT=(Ex: 10051)
    ZABBIX_WEB_HTTP_PORT=(Ex: 8080)
    ZABBIX_WEB_HTTPS_PORT=(Ex: 8443)
    ```
    **Importante:** Adicione `.env` ao seu arquivo `.gitignore` para proteger suas credenciais.

3.  **Inicie os cont√™ineres:**
    ```bash
    docker compose up -d
    ```

4.  **Acesse o Zabbix:** Abra o navegador e acesse a interface web na porta definida:
    * **HTTP:** `http://localhost:8080` (ou a porta que voc√™ configurou).

5.  **Fa√ßa login:**
    * **Usu√°rio:** `Admin`
    * **Senha:** `zabbix`
    * **Recomenda√ß√£o:** Altere a senha padr√£o imediatamente.

---

### Gerenciando os cont√™ineres (parar | pausar)

No diret√≥rio do projeto, utilize os seguintes comandos:

1.  **Parar e remover (permanente):**
    ```bash
    docker compose down
    ```
2.  **Parar e remover tudo (limpeza completa, incluindo volumes de dados):**
    ```bash
    docker compose down -v
    ```
3.  **Pausar cont√™ineres:**
    ```bash
    docker compose pause
    ```
4.  **Retomar cont√™ineres pausados:**
    ```bash
    docker compose unpause
    ```

---

### üìù Notas do projeto

* Este projeto utiliza **Zabbix com MySQL** para garantir robustez e performance.
* A estrutura dos servi√ßos est√° definida no arquivo `docker-compose.yml`.
* O arquivo `zabbix-mysql.cnf` cont√©m otimiza√ß√µes para o MySQL.

---

### üìä Configura√ß√£o inicial de monitoramento

Para um in√≠cio r√°pido, importe hosts de exemplo e crie um dashboard.

#### 1. Importar hosts de exemplo

* O arquivo `data/exemplo-hosts.yaml` cont√©m exemplos para monitorar Google, CloudFlare e GitHub.
* Para importar:
    1.  No menu do Zabbix, v√° para **Data collection > Hosts**.

        ![Menu Data Collection](./img/image.png)

    2.  Clique no bot√£o **Import** no canto superior direito.
        ![Bot√£o Import](./img/image2.png)
    3.  Selecione o arquivo `data/exemplo-hosts.yaml` e siga as instru√ß√µes.

#### 2. Criar um dashboard b√°sico

1.  No menu, clique em **Dashboards**.

    ![Menu Dashboards](./img/image4.png)
2.  Clique em **Create Dashboard**.
    ![Bot√£o Create Dashboard](./img/image5.png)
3.  D√™ um nome ao dashboard e clique em **Apply**.
    ![Cria√ß√£o do Dashboard](./img/image6.png)
4.  Adicione widgets (como `Graph`) para visualizar os dados dos seus hosts.
    ![Configura√ß√£o de widget do dashboard](./img/image7.png)